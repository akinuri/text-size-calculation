<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Text Size Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-200 p-4">

<div class="flex flex-col gap-4 items-start text-slate-700">
    <div class="flex gap-4 items-center">
        <select id="local-fonts" class="p-2 rounded shadow" data-placeholder="Select a font">
            <option class="text-gray-400">Select a font</option>
            <option selected style="font-family: Arial, sans-serif;">Arial</option>
        </select>
        <button
            class="bg-slate-50 rounded px-3 py-1 shadow hover:bg-slate-100 active:bg-slate-100/70"
            onclick="loadLocalFonts(this)"
            >
            Load Local Fonts
        </button>
    </div>
    <div>
        <span class="inline-block w-20">Uppercase</span>
        <input
            type="text"
            class="px-2 py-1 border border-slate-300 w-96 rounded"
            value="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
            id="uppercase-letters"
            >
    </div>
    <div>
        <span class="inline-block w-20">Lowercase</span>
        <input
            type="text"
            class="px-2 py-1 border border-slate-300 w-96 rounded"
            value="abcdefghijklmnopqrstuvwxyz"
            id="lowercase-letters"
            >
    </div>
    <div>
        <span class="inline-block w-20">Other</span>
        <input
            type="text"
            class="px-2 py-1 border border-slate-300 w-96 rounded"
            value="&nbsp;!&quot;\#$%&'()*+,-./:;<=\&gt;?@[\]^_`{|}~"
            id="other-letters"
            >
    </div>
    <button
        class="bg-slate-50 rounded px-3 py-1 shadow hover:bg-slate-100 active:bg-slate-100/70"
        onclick="printLetters()"
        >
        Print Letters
    </button>
</div>

<hr class="my-4 border-slate-300">

<div id="letters-container" class="flex flex-col gap-4 font-[Arial] text-[50px] leading-none">
    <div class="flex items-center gap-4" id="uppercase-container"></div>
    <div class="flex items-center gap-4" id="lowercase-container"></div>
    <div class="flex items-center gap-4" id="other-container"></div>
</div>

<script>
    let localFontsEl = document.querySelector("#local-fonts");
    
    let lettersContainer = document.querySelector("#letters-container");
    
    let uppercaseContainer  = document.querySelector("#uppercase-container");
    let lowercaseContainer  = document.querySelector("#lowercase-container");
    let otherContainer      = document.querySelector("#other-container");
    
    let uppercaseLettersBox = document.querySelector("#uppercase-letters");
    let lowercaseLettersBox = document.querySelector("#lowercase-letters");
    let otherLettersBox     = document.querySelector("#other-letters");
    
    localFontsEl.addEventListener("change", () => {
        let value = localFontsEl.value;
        if (value == localFontsEl.dataset.placeholder) {
            value = "";
        }
        lettersContainer.style.fontFamily = value;
    });
    
    printLetters();
    
    async function loadLocalFonts(callerBtn) {
        let fonts = await getFontData();
        if (fonts.length == 0) {
            return;
        }
        localFontsEl.lastElementChild.remove();
        let fontFamilies = groupByProperty(fonts, "family");
        Object.keys(fontFamilies).forEach(family => {
            let selected = "";
            if (family == "Arial") {
                selected = " selected";
            }
            localFontsEl.innerHTML += `
                <option${selected} style="font-family: '${family}'">${family}</option>
            `;
        });
        callerBtn.remove();
    }
    async function getFontData() {
        try {
            return await window.queryLocalFonts();
        } catch (err) {
            console.error(err.name, err.message);
        }
    }
    function groupByProperty(arr, property) {
        return arr.reduce((acc, obj) => {
            const key = obj[property];
            if (!acc[key]) {
                acc[key] = [];
            }
            acc[key].push(obj);
            return acc;
        }, {});
    }
    
    function printLetters() {
        uppercaseContainer.innerHTML = "";
        uppercaseLettersBox.value.split("").forEach(letter => {
            uppercaseContainer.innerHTML += `<div class="bg-white shadow">${letter}</div>`;
        });
        lowercaseContainer.innerHTML = "";
        lowercaseLettersBox.value.split("").forEach(letter => {
            lowercaseContainer.innerHTML += `<div class="bg-white shadow">${letter}</div>`;
        });
        otherContainer.innerHTML = "";
        otherLettersBox.value.split("").forEach(letter => {
            otherContainer.innerHTML += `<div class="bg-white shadow">${letter}</div>`;
        });
    }
</script>

</body>
</html>